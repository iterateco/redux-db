var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},__extends=this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();define("errors",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={fkInvalidReference:function(e){return'The foreign key: "'+e+'" does not define a valid referenced table.'},fkReferenceNotInSession:function(e,t){return'The foreign key: "'+e+'" references an unregistered table: "'+t+'" in the current session.'},fkUndefined:function(e,t){return"No foreign key named: "+t+' in the schema: "'+e+'".'},fkViolation:function(e,t){return'The insert/update operation violates the unique foreign key "'+e+"."+t+'".'},recordNotFound:function(e,t){return'No "'+e+'" record with id: '+t+" exists."},recordUpdateNotFound:function(e,t){return'Failed to apply update. No "'+e+'" record with id: '+t+" exists."},reservedProperty:function(e,t){return'The property "'+e+"."+t+'" is a reserved name. Please specify another name using the "propName" definition.'},sessionReadonly:function(){return"Invalid attempt to alter a readonly session."},stateTableUndefined:function(){return"Failed to select table. Could not identify table schema."},tableInvalidState:function(e){return'The table "'+e+'" has an invalid state.'},tableNotInSession:function(e){return'The table: "'+e+'" does not exist in the current session.'}}}),define("types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TYPE_PK="PK",t.TYPE_ATTR="ATTR",t.TYPE_MODIFIED="MODIFIED",t.RESERVED_PROPERTIES=["id","table","value","_fields"]}),define("models/RecordFieldModel",["require","exports","utils"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.schema=r.ensureParam("schema",e),this.record=r.ensureParam("record",t),this.name=r.ensureParamString("schema.name",e.name)}return Object.defineProperty(e.prototype,"value",{get:function(){return this.schema.getRecordValue(this.record)},enumerable:!0,configurable:!0}),e}();t.default=n}),define("models/RecordModel",["require","exports","utils"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.id=r.ensureParam("id",e),this.table=r.ensureParam("table",t)}return Object.defineProperty(e.prototype,"value",{get:function(){return this.table.getValue(this.id)||{}},set:function(e){this.update(e)},enumerable:!0,configurable:!0}),e.prototype.delete=function(){this.table.delete(this.id)},e.prototype.update=function(e){return this.table.schema.injectKeys(e,this),this.table.update(e),this},e}();t.default=n}),define("models/RecordSetModel",["require","exports","utils"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,r){this.table=n.ensureParam("table",e),this.schema=n.ensureParam("schema",t),this.owner=n.ensureParam("owner",r)}return Object.defineProperty(e.prototype,"ids",{get:function(){return this.table.getIndex(this.schema.name,this.owner.id)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this.ids.length},enumerable:!0,configurable:!0}),e.prototype.all=function(){var t=this;return this.ids.map(function(e){return t.table.schema.db.factory.newRecordModel(e,t.table)})},e.prototype.getValue=function(){return this.all().map(function(e){return e.value})},e.prototype.add=function(e){this.table.insert(this._normalize(e))},e.prototype.remove=function(e){var r=this;this._normalize(e).forEach(function(e){var t=r.table.schema.getPrimaryKey(e);r.table.delete(t)})},e.prototype.update=function(e){return this.table.update(this._normalize(e)),this},e.prototype.delete=function(){var t=this;this.ids.forEach(function(e){return t.table.delete(e)})},e.prototype._normalize=function(e){return this.table.schema.inferRelations(e,this.schema,this.owner.id)},e}();t.default=r}),define("models/NormalizeContext",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.output={},this.emits={},this.schema=e,this.db=e.db,this.normalizePKs=t}return e.prototype.emit=function(e,t){this.emits[e]=this.emits[e]||[],this.emits[e].push(t)},e}();t.default=r}),define("models/TableModel",["require","exports","errors","utils","models/NormalizeContext"],function(e,t,s,u,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,r){void 0===r&&(r={ids:[],byId:{},indexes:{}}),this.dirty=!1,this.session=u.ensureParam("session",e),this.schema=u.ensureParam("schema",t),this.state=u.ensureParam("state",r);var n=this.state,i=n.ids,o=n.byId,a=n.indexes;if(!i||!o||!a)throw new Error(s.default.tableInvalidState(t.name));this.state.name||(this.state.name=t.name)}return Object.defineProperty(e.prototype,"length",{get:function(){return this.state.ids.length},enumerable:!0,configurable:!0}),e.prototype.all=function(){var t=this;return this.state.ids.map(function(e){return t.schema.db.factory.newRecordModel(e,t)})},e.prototype.getValues=function(){var t=this;return this.state.ids.map(function(e){return t.state.byId[e]})},e.prototype.get=function(e){if(!this.exists(e))throw new Error(s.default.recordNotFound(this.schema.name,e));return this.schema.db.factory.newRecordModel(u.asID(e),this)},e.prototype.getOrDefault=function(e){return this.exists(e)?this.get(e):null},e.prototype.getByFk=function(t,e){u.ensureParam("fieldName",t),e=u.ensureID(e);var r=this.schema.fields.filter(function(e){return e.isForeignKey&&e.name===t})[0];if(!r)throw new Error(s.default.fkUndefined(this.schema.name,t));return this.schema.db.factory.newRecordSetModel(this,r,{id:e})},e.prototype.getFieldValue=function(e,t){var r=this.getOrDefault(e);return r?r.value[t]:void 0},e.prototype.getValue=function(e){return u.isValidID(e)?this.state.byId[e]:void 0},e.prototype.getIndex=function(e,t){return u.ensureParamString("value",e),u.ensureParamString("fk",t),this.state.indexes[e]&&this.state.indexes[e].values[t]?this.state.indexes[e].values[t]:[]},e.prototype.exists=function(e){return!!u.isValidID(e)&&void 0!==this.state.byId[u.asID(e)]},e.prototype.insert=function(e){return this._normalizedAction(e,this.insertNormalized,!0)},e.prototype.update=function(e){return this._normalizedAction(e,this.updateNormalized,!1)},e.prototype.upsert=function(e){return this._normalizedAction(e,this.upsertNormalized,!0)},e.prototype.delete=function(e){if("string"!=typeof e&&"number"!=typeof e&&(e=this.schema.getPrimaryKey(e)),!this.exists(e))return!1;e=u.asID(e),this._deleteCascade(e);var t=__assign({},this.state.byId),r=this.state.ids.slice(),n=__assign({},this.state.indexes),i=t[e];delete t[e];var o=r.indexOf(e);return 0<=o&&r.splice(o,1),i&&this._cleanIndexes(e,i,n),this.dirty=!0,this.state=__assign({},this.state,{byId:t,ids:r,indexes:n}),!0},e.prototype.deleteAll=function(){this.length&&this.all().forEach(function(e){return e.delete()})},e.prototype.insertNormalized=function(e){var t=this;return u.ensureParam("table",e),this.dirty=!0,this.state=__assign({},this.state,{byId:__assign({},this.state.byId,e.byId),ids:u.mergeIds(this.state.ids,e.ids,!0)}),this._updateIndexes(e),e.ids.map(function(e){return t.schema.db.factory.newRecordModel(e,t)})},e.prototype.updateNormalized=function(n){var i=this;u.ensureParam("table",n);var o=__assign({},this.state),a=!1,e=Object.keys(n.byId).map(function(e){if(!i.state.byId[e])throw new Error(s.default.recordUpdateNotFound(i.schema.name,e));var t=o.byId[e],r=__assign({},t,n.byId[e]);return i.schema.isModified(t,r)&&(o.byId[e]=r,a=!0),i.schema.db.factory.newRecordModel(e,i)});return a&&(this.dirty=!0,this.state=o,this._updateIndexes(n)),e},e.prototype.upsertNormalized=function(t){var r=this;u.ensureParam("table",t);var n={ids:[],byId:{},indexes:{}},i={ids:[],byId:{},indexes:{}};t.ids.forEach(function(e){r.exists(e)?(n.ids.push(e),n.byId[e]=t.byId[e]):(i.ids.push(e),i.byId[e]=t.byId[e])});var e=(n.ids.length?this.updateNormalized(n):[]).concat(i.ids.length?this.insertNormalized(i):[]);return this._updateIndexes(t),e},e.prototype._normalizedAction=function(e,t,r){u.ensureParam("data",e),u.ensureParam("action",t);var n=new a.default(this.schema,r);this.schema.normalize(e,n);var i=n.output[this.schema.name],o=i?t.call(this,i):[];return this.session.upsert(n),o},e.prototype._updateIndexes=function(o){var a=this;Object.keys(o.indexes).forEach(function(n){var i=a.state.indexes[n]||(a.state.indexes[n]={unique:o.indexes[n].unique,values:{}});Object.keys(o.indexes[n].values).forEach(function(e){var t=i.values[e]||(i.values[e]=[]),r=u.mergeIds(t,o.indexes[n].values[e],!1);if(i.unique&&1<r.length)throw new Error(s.default.fkViolation(a.schema.name,n));i.values[e]=r})})},e.prototype._cleanIndexes=function(n,e,i){this.schema.getForeignKeys(e).forEach(function(e){var t=-1;if(e.value&&i[e.name]&&i[e.name].values[e.value]&&(t=i[e.name].values[e.value].indexOf(n)),0<=t){var r=i[e.name].values[e.value].slice();r.splice(t,1),i[e.name].values[e.value]=r}else i[e.name]&&(delete i[e.name].values[n],0===Object.keys(i[e.name].values).length&&delete i[e.name])})},e.prototype._deleteCascade=function(e){var t=this.schema.relations.filter(function(e){return e.relationName&&e.cascade});if(t.length){var r=this.get(e);r&&t.forEach(function(e){var t=r[e.relationName];t&&t.delete()})}},e}();t.default=r}),define("models/FieldSchemaModel",["require","exports","constants","utils"],function(e,t,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,r,n){this.table=o.ensureParam("table",e),this.type=r.type||i.TYPE_ATTR,this.name=t,this.propName=r.propName||t,this._valueFactory=r.value?r.value.bind(this):null,this.isPrimaryKey=r.type===i.TYPE_PK,this.isForeignKey=null!==r.references&&void 0!==r.references,this.isPrimaryKey||this.isForeignKey?(this.references=r.references,this.relationName=r.relationName,this.cascade=void 0===r.cascade?n:!0===r.cascade,this.unique=!0===r.unique,this.notNull=void 0===r.notNull||!0===r.notNull):(this.cascade=!1,this.unique=!1,this.notNull=!0===r.notNull)}return Object.defineProperty(e.prototype,"refTable",{get:function(){return this._refTable},enumerable:!0,configurable:!0}),e.prototype.connect=function(e){var t=this;if(this.references&&(this._refTable=e.filter(function(e){return e.name===t.references})[0],!this._refTable))throw new Error('The field schema "'+this.table.name+"."+this.name+'" has an invalid reference to unknown table "'+this.references+'".')},e.prototype.getValue=function(e,t){return this._valueFactory?this._valueFactory(e,{record:t,schema:this}):e[this.name]},e.prototype.getRecordValue=function(e){return this.getValue(e.value,e)},e}();t.default=r}),define("models/TableSchemaModel",["require","exports","constants","utils","models/FieldSchemaModel"],function(e,t,i,l,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(t,e,r){var n=this;this._relations=[],this.db=l.ensureParam("db",t),this.name=l.ensureParamString("name",e),this.fields=Object.keys(l.ensureParam("schema",r)).map(function(e){return new o.default(n,e,r[e],!0===t.options.cascadeAsDefault)}),this._primaryKeyFields=this.fields.filter(function(e){return e.isPrimaryKey}),this._foreignKeyFields=this.fields.filter(function(e){return e.isForeignKey}),this._stampFields=this.fields.filter(function(e){return e.type===i.TYPE_MODIFIED})}return Object.defineProperty(e.prototype,"relations",{get:function(){return this._relations},enumerable:!0,configurable:!0}),e.prototype.connect=function(t){var r=this;t.forEach(function(e){return r._relations=r._relations.concat(e.fields.filter(function(e){return e.references===r.name}))}),this._foreignKeyFields.forEach(function(e){return e.connect(t)})},e.prototype.normalize=function(e,t){var s=this;if("object"!=typeof e&&!Array.isArray(e))throw new Error("Failed to normalize data. Given argument is not a plain object nor an array.");var u=l.ensureParam("context",t);return u.output[this.name]||(u.output[this.name]={ids:[],byId:{},indexes:{}}),l.ensureArray(e).map(function(e){if("object"!=typeof e)throw new Error("Failed to normalize data. Given record is not a plain object.");var t=s.db.getNormalizer(s.name);t&&(e=t(e,u));var i=u.normalizePKs?s._normalizePrimaryKey(e):s._getPrimaryKey(e);if(!i)throw new Error('Failed to normalize primary key for record of type "'+s.name+'". Make sure record(s) have a primary key value before trying to insert or update a table.');var r=s.getForeignKeys(e),o=u.output[s.name];o.byId[i]||o.ids.push(i);var a=o.byId[i]=__assign({},e);return r.forEach(function(e){if("object"==typeof e.value&&e.refTable){var t=e.refTable.normalize(e.value,u);if(1<t.length)throw new Error('Invalid schema definition. The field "'+s.name+"."+e.name+'" is referencing table "'+e.refTable.name+'", but the given data is an array.');a[e.name]=e.value=t[0]}if(l.isValidID(e.value)){var r=l.asID(e.value),n=o.indexes[e.name]||(o.indexes[e.name]={unique:e.unique,values:{}});if(n.values[r]||(n.values[r]=[]),n.unique&&n.values.length)throw new Error('The insert/update operation violates the unique foreign key "'+s.name+"."+e.name+'".');n.values[r].push(i)}}),s.relations.forEach(function(e){if(e.relationName&&a[e.relationName]){var t=s.inferRelations(a[e.relationName],e,i);e.table.normalize(t,u),delete a[e.relationName]}}),i})},e.prototype.inferRelations=function(e,n,i){if(!n.relationName)return e;var o=n.table.fields.filter(function(e){return e.isForeignKey&&e!==n});return l.ensureArray(e).map(function(e){var t,r;return"number"!=typeof e&&"string"!=typeof e||(1===o.length?((t={})[o[0].name]=e,e=t):e={id:e}),__assign({},e,((r={})[n.name]=i,r))})},e.prototype.injectKeys=function(t,r){if(!t||"object"!=typeof t)return t;var e=this._primaryKeyFields;e.length||(e=this._foreignKeyFields),e.forEach(function(e){void 0===t[e.name]&&(t[e.name]=e.getRecordValue(r))})},e.prototype.getPrimaryKey=function(e){var t=this._getPrimaryKey(e);if(!t)throw new Error('Failed to get primary key for record of type "'+this.name+'".');return t},e.prototype.getForeignKeys=function(t){return this._foreignKeyFields.map(function(e){return{name:e.name,notNull:e.notNull,refTable:e.refTable,unique:e.unique,value:t[e.name]}})},e.prototype.isModified=function(r,n){return 0<this._stampFields.length?this._stampFields.reduce(function(e,t){return e+(t.getValue(r)===t.getValue(n)?1:0)},0)!==this._stampFields.length:!this.db.getRecordComparer(this.name)(r,n,this)},e.prototype._getPrimaryKey=function(n){var e=(this._primaryKeyFields.length?this._primaryKeyFields:this._foreignKeyFields).reduce(function(e,t){var r=t.getValue(n);return e&&r?e+"_"+r:r},null);return l.isValidID(e)&&l.asID(e)},e.prototype._normalizePrimaryKey=function(e){var t=this._getPrimaryKey(e);if(!t){var r=this.db.getPkGenerator(this.name)(e,this);r&&(1===this._primaryKeyFields.length&&(e[this._primaryKeyFields[0].propName]=r),t=r)}return t},e}();t.default=r}),define("models/index",["require","exports","models/RecordFieldModel","models/RecordModel","models/RecordSetModel","models/TableModel","models/TableSchemaModel"],function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={RecordFieldModel:r.default,RecordModel:n.default,RecordSetModel:i.default,TableModel:o.default,TableSchemaModel:a.default}}),define("DefaultModelFactory",["require","exports","constants","errors","models/RecordFieldModel","models/RecordModel","models/RecordSetModel","models/TableModel","models/TableSchemaModel"],function(e,t,o,a,i,r,n,s,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(){this._recordClass={},this._defineProperty=function(e,t,r,n,i){if(void 0===i&&(i=!0),0<=o.RESERVED_PROPERTIES.indexOf(t))throw new Error(a.default.reservedProperty(r.table.name,t));Object.defineProperty(e.prototype,t,{get:function(){return i?this._fields[t]||(this._fields[t]=n(r,this)):n(r,this)}})}}return e.prototype.newTableSchema=function(e,t,r){return new u.default(e,t,r)},e.prototype.newTableModel=function(e,t,r){return new s.default(e,t,r)},e.prototype.newRecordModel=function(e,t){return new(this.createRecordModel(t.schema))(e,t)},e.prototype.newRecordSetModel=function(e,t,r){return new n.default(e,t,r)},e.prototype.getRecordBaseClass=function(e){return r.default},e.prototype.createRecordModel=function(e){var t=this;if(this._recordClass[e.name])return this._recordClass[e.name];var r=function(n){function e(e,t){var r=n.call(this,e,t)||this;return r._fields={},r}return __extends(e,n),e}(this.getRecordBaseClass(e));return e.fields.forEach(function(e){return(e.isForeignKey||!e.isPrimaryKey)&&t._defineProperty(r,e.propName,e,t._newRecordField.bind(t),!1)}),e.relations.forEach(function(e){return e.relationName&&t._defineProperty(r,e.relationName,e,e.unique?t._newRecordRelation.bind(t):t._newRecordSet.bind(t),!e.unique)}),this._recordClass[e.name]=r},e.prototype._newRecordField=function(e,t){if(!e.isForeignKey)return new i.default(e,t);if(!e.references)throw new Error(a.default.fkInvalidReference(e.name));var r=e.references&&t.table.session.tables[e.references];if(!r)throw new Error(a.default.fkReferenceNotInSession(e.name,e.references));var n=e.getRecordValue(t);return void 0===n?null:r.getOrDefault(n)},e.prototype._newRecordSet=function(e,t){var r=t.table.session.tables[e.table.name];if(!r)throw new Error(a.default.tableNotInSession(e.table.name));return this.newRecordSetModel(r,e,t)},e.prototype._newRecordRelation=function(e,t){var r=t.table.session.tables[e.table.name];if(!r)throw new Error(a.default.tableNotInSession(e.table.name));var n=r.getIndex(e.name,t.id)[0];return void 0===n?null:this.newRecordModel(n,r)},e}();t.default=l}),define("index",["require","exports","Database","constants","models/index","DefaultModelFactory"],function(e,r,n,t,i,o){"use strict";function a(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),r.createDatabase=function(e,t){return new n.default(e,t)},a(t),a(i),a(o)}),define("utils",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toArray=function(t){return t?Array.isArray(t)?t:"object"==typeof t?Object.keys(t).map(function(e){return t[e]}):[]:[]},t.ensureArray=function(e){return e?Array.isArray(e)?e:[e]:[]},t.ensureParam=function(e,t){if(void 0===t)throw new Error('Missing a valid value for the argument "'+e+'"');return t},t.ensureParamString=function(e,t){if(null==t||"string"!=typeof t||0===t.length)throw new Error('Missing a valid string for the argument "'+e+'"');return t},t.ensureID=function(e){if(!t.isValidID(e))throw new Error('The given value is not a valid "id". An "id" must be a non-empty string or a number.');return t.asID(e)},t.isValidID=function(e){return null!=e&&("string"==typeof e&&0<e.length||"number"==typeof e)},t.asID=function(e){return"string"==typeof e?e:e.toString()},t.toObject=function(e,r){return e.reduce(function(e,t){return e[r(t)]=t,e},{})},t.mergeIds=function(e,t,r){var n,i={};for(n=0;n<e.length;n++)i[e[n]]=!0;for(n=0;n<t.length;n++){if(r&&i[t[n]])throw new Error('Id merge operation violates unique constraint for id: "'+t[n]+'"');i[t[n]]=!0}return Object.keys(i)},t.isEqual=function(e,t){if(e===t)return!0;var r=Object.keys(e),n=Object.keys(t),i=r.length;if(n.length!==i)return!1;for(var o=0;o<i;o++){var a=r[o];if(!(Array.isArray(e[a])&&Array.isArray(t[a])&&s(e[a],t[a]))&&e[a]!==t[a])return!1}return!0};var s=function(e,t){if(e===t)return!0;var r=e.length;if(t.length!==r)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}}),define("DatabaseSession",["require","exports","errors","utils"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(t,e,r){void 0===t&&(t={});var n=this;this.state=t,this.db=e;var i=(this.options=r).tableSchemas||e.tables;this.tables=o.toObject(i.map(function(e){return n.db.factory.newTableModel(n,e,t[e.name])}),function(e){return e.schema.name})}return e.prototype.upsert=function(t){var r=this;if(this.options.readOnly)throw new Error(n.default.sessionReadonly());Object.keys(t.output).forEach(function(e){e!==t.schema.name&&r.tables[e].upsertNormalized(t.output[e])}),Object.keys(t.emits).forEach(function(e){e!==t.schema.name&&r.tables[e].upsert(t.emits[e])})},e.prototype.commit=function(){var i=this;if(this.options.readOnly)throw new Error(n.default.sessionReadonly());return Object.keys(this.tables).forEach(function(e){var t,r=i.state[e],n=i.tables[e].state;r!==n&&(i.state=__assign({},i.state,((t={})[e]=n,t)))}),this.state},e}();t.default=r}),define("Database",["require","exports","DatabaseSession","DefaultModelFactory","errors","utils"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={cascadeAsDefault:!1},s=function(e,t,r){return e?"function"==typeof e?e:e[t]?e[t]:r:r},u=function(){function e(t,e){var r=this;this.getNormalizer=function(e){return s(r.options.onNormalize,e,function(e){return e})},this.getPkGenerator=function(e){return s(r.options.onGeneratePK,e,function(){})},this.getRecordComparer=function(e){return s(r.options.onRecordCompare,e,o.isEqual)},o.ensureParam("schema",t),this.options=__assign({},a,e),this.factory=this.options.factory||new n.default,this.tables=Object.keys(t).map(function(e){return r.factory.newTableSchema(r,e,t[e])}),this.tables.forEach(function(e){return e.connect(r.tables)}),this._tableLookup=o.toObject(this.tables,function(e){return e.name})}return e.prototype.combineReducers=function(){for(var r=this,n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return function(e,t){return void 0===e&&(e={}),r.reduce(e,t,n)}},e.prototype.reduce=function(e,t,r,n){var i=this.createSession(e);return o.ensureArray(r).forEach(function(e){return e(i.tables,t,n)}),i.commit()},e.prototype.createSession=function(e,t){return new r.default(e,this,__assign({readOnly:!1},t))},e.prototype.selectTables=function(e){var t=this,r=Object.keys(e).filter(function(e){return t._tableLookup[e]}).map(function(e){return t._tableLookup[e]});return this.createSession(e,{readOnly:!0,tableSchemas:r}).tables},e.prototype.selectTable=function(e,t){var r,n=t||e.name;if(!n)throw new Error(i.default.stateTableUndefined());return this.selectTables((r={},r[n]=e,r))[n]},e}();t.default=u});